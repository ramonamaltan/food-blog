<div class="page-container">
  <div class="mobile-container">
    <div class="desktop-button-flex">
      <h1>Alle Rezepte</h1>
      <%= link_to 'Rezept hinzufügen', new_recipe_path, class: "btn-petrol my-3" if @admin %>
    </div>

    <div class="search-form-control">
      <%= form_with model: @recipe, method: :get do |form| %>
        <%= form.text_field :search, class: "form-control my-3", placeholder: "Finde ein Rezept" %>
        <%= form.submit "Suchen", class: "btn btn-red" %>
      <% end %>
    </div>

    <%= form_with model: @recipe, method: :get, class: 'mb-4' do |form| %>
      <%= form.fields_for :categories do |cat_form| %>
        <%= cat_form.collection_select :category, Category.order(:name), :id, :name, onclick: 'this.form.submit()'  %>
      <% end %>
      <%= form.submit "Filter", class: "btn btn-red" %>
    <% end %>

    <%= form_with model: @recipe, method: :get, class: 'mb-4' do |form| %> 
      <%= form.label :recent, 'Neue zuerst' %>
      <%= check_box_tag :recent, true, (params[:alphabetical] == 'true'), onclick: 'this.form.submit()' %>
      <%= form.label :alphabetical, 'A-Z' %>
      <%= check_box_tag :alphabetical, true, (params[:alphabetical] == 'true'), onclick: 'this.form.submit()' %>
    <% end %>
  </div>

  <div class="cards">
    <% @recipes.each do |recipe| %>
      <div class="recipe-card">
        <% if recipe.photo.attached? %>
          <%= cl_image_tag recipe.photo.key, height: 300, width: 400, crop: :fill %>
        <% end %>
        
        <div class="recipe-infos">
          <div class="flex flex-jc-sb flex-ai-c mb-2">
            <h2><%= link_to recipe.name, recipe_path(recipe) %></h2>
            <%= form_with model: @favorite_recipe, url: recipe_favorite_recipes_url(recipe) do |form| %>
              <%= button_tag type: 'submit', class: 'btn-text-white', id: 'btn-heart', style:'padding:0;' do %>
                <% if FavoriteRecipe.where(recipe: recipe, user: current_user).count.positive? %>
                  <i class="fas fa-heart" id='icon-heart'></i>
                <% else %>
                  <i class="far fa-heart" id='icon-heart'></i>
                <% end %>
              <% end %>
            <% end %>
          </div>
          <%= link_to "Löschen", recipe, method: :delete, remote: true, data: { confirm: 'Are you sure?' }, class: 'delete' if @admin %>
        </div>

      </div>
    <% end %>
  </div>
</div>
